/*!
 * Copyright (C) Microsoft Corporation. All rights reserved.
 */
import { executePluginAsync } from '../plugin/PluginCommon';
import { IncompatibleMessageReceiver } from './IncompatibleMessageReceiver';
import { CompatibleMessageReceiver } from './CompatibleMessageReceiver';
export class SendMessage {
    static createInstanceAsync() {
        return Promise.resolve(new SendMessage());
    }
    constructor() { }
    async getMessageReceiverAsync(receiverName, isCompatibleChecker) {
        const versionInfo = await this._getVersionInfo(receiverName);
        if (versionInfo) {
            const compatibilityCheckerResult = isCompatibleChecker(versionInfo);
            if (compatibilityCheckerResult.isCompatible === false) {
                return new IncompatibleMessageReceiver(versionInfo, compatibilityCheckerResult.incompatibilityDescription || '');
            }
            else {
                return new CompatibleMessageReceiver(receiverName, versionInfo);
            }
        }
        else {
            return new IncompatibleMessageReceiver(undefined, `No receiver ${receiverName} registered.`);
        }
    }
    async _getVersionInfo(receiverName) {
        const result = await executePluginAsync('SendMessagePlugin', 'getVersionInfo', [receiverName]);
        return result;
    }
}
//# sourceMappingURL=SendMessage.js.map