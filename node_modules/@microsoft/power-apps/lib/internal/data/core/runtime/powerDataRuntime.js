/*!
 * Copyright (C) Microsoft Corporation. All rights reserved.
 */
import { DefaultDataOperationOrchestrator } from '../data/defaultOperationOrchestrator';
import { RuntimeMetadataOperations } from '../metadata/runtimeMetadataOperations';
import { RuntimeClientProvider } from '../runtimeClient/runtimeClientProvider';
import { DataverseDataOperationExecutor } from '../data/executors/dataverseDataOperationExecutor';
import { ConnectorDataOperationExecutor } from '../data/executors/connectorDataOperationExecutor';
import { RuntimeDataSourceService } from '../metadata/runtimeDataSourceService';
import { Log } from '../telemetry/log';
import { ErrorCodes, getErrorMessage, PowerDataRuntimeError } from '../error/error';
/**
 * PowerDataRuntime provides a unified interface for data and metadata operations
 * in the Power runtime environment.
 */
export class PowerDataRuntime {
    _clientProvider;
    _dataSourceService;
    _dataOperations;
    _metadataOperations;
    _isInitialized;
    /**
     * Creates a new instance of PowerDataRuntime
     * @param params - Initialization parameters
     * @throws DataRuntimeError if initialization fails
     */
    constructor(params) {
        try {
            // Initialize the telemetry logger
            Log.createInstance(params.powerOperationExecutor);
            this._clientProvider = new RuntimeClientProvider(params.powerOperationExecutor);
            this._dataSourceService = new RuntimeDataSourceService(params.powerDataSourcesInfoProvider);
            this._isInitialized = false;
            this._initialize();
        }
        catch (error) {
            if (error instanceof Error) {
                Log.trackException(error);
            }
            throw error;
        }
    }
    /**
     * Gets the Data operations interface
     * @throws PowerDataRuntimeError if operations are not initialized
     */
    get Data() {
        this._ensureInitialized();
        if (!this._dataOperations) {
            this._dataOperations = this._createDataOperations();
        }
        return this._dataOperations;
    }
    /**
     * Gets the Metadata operations interface
     * @throws PowerDataRuntimeError if operations are not initialized
     */
    get Metadata() {
        this._ensureInitialized();
        if (!this._metadataOperations) {
            this._metadataOperations = this._createMetadataOperations();
        }
        return this._metadataOperations;
    }
    /**
     * Ensures the PowerDataRuntime is initialized
     * @throws PowerDataRuntimeError if not initialized
     */
    _ensureInitialized() {
        if (!this._isInitialized) {
            throw new PowerDataRuntimeError(ErrorCodes.OperationsNotInitialized);
        }
    }
    /**
     * Initializes the PowerDataRuntime components
     * @throws PowerDataRuntimeError if initialization fails
     */
    _initialize() {
        try {
            this._dataOperations = this._createDataOperations();
            this._metadataOperations = this._createMetadataOperations();
            this._isInitialized = true;
        }
        catch (error) {
            throw new PowerDataRuntimeError(ErrorCodes.InitializationFailed, getErrorMessage(error));
        }
    }
    /**
     * Creates a new instance of DataOperations
     */
    _createDataOperations() {
        const dataverseOperation = new DataverseDataOperationExecutor(this._clientProvider);
        const connectorOperation = new ConnectorDataOperationExecutor(this._clientProvider, this._dataSourceService);
        return new DefaultDataOperationOrchestrator(dataverseOperation, connectorOperation, this._dataSourceService);
    }
    /**
     * Creates a new instance of MetadataOperations
     */
    _createMetadataOperations() {
        return new RuntimeMetadataOperations(this._clientProvider);
    }
}
//# sourceMappingURL=powerDataRuntime.js.map