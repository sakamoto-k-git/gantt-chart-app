/*!
 * Copyright (C) Microsoft Corporation. All rights reserved.
 */
import { executePlugin, initializePlugins } from '../internal/plugin/PluginCommon';
import { setupLogger } from '../telemetry/LoggerManager';
import { getPerformanceData } from '../telemetry/Performance';
import { initializeData } from '../data/powerAppsData';
let initializeCalled = false;
let resolveIsInitializedPromise;
const isInitializedPromise = new Promise((resolve) => {
    resolveIsInitializedPromise = resolve;
});
export async function initialize(options) {
    if (!initializeCalled || !(await isInitializedPromise)) {
        initializeCalled = true;
        const { logger, data } = options ?? {};
        await initializePlugins();
        initializeData(data?.executor);
        if (logger) {
            setupLogger(logger);
        }
        executePlugin('AppLifecycle', 'notifyAppIndexLoaded');
        executePlugin('AppLifecycle', 'notifyAppLoaded', [getAppLoadedPerformanceData(), {}, '']);
        resolveIsInitializedPromise(true);
    }
}
export function getAppLoadedPerformanceData() {
    try {
        const perfData = getPerformanceData();
        return JSON.stringify(perfData);
    }
    catch (e) {
        return '{}';
    }
}
export function getIsInitializedPromise() {
    return isInitializedPromise;
}
//# sourceMappingURL=Lifecycle.js.map